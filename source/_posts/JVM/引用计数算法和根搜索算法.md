---
title: 引用计数算法和根搜索算法
date: 2017-03-10 11:34:47
categories: JVM
---

要判断JVM中哪些对象是可以被回收的。有两种算法，一起了解一下。

## 引用计数算法
### 实现方式
给一个对象添加一个引用计数器，每当有一个地方引用它时，则引用计数器+1，当引用失效的时候-1。当减到0的时候，则说明该对象可以被回收了。

这个算法有个致命的缺陷，当有循环引用的时候就不行了。如下图，如果用引用计数算法，则这两个对象都不会被GC回收了。所以Java使用的是根搜索算法。

![image](http://p1.bpimg.com/567571/32ae7aaeee9f5952.png)

## 根搜索算法
### 实现方法
指定一系列的叫做“GC Roots”的对象，以这些对象作为起点往下遍历搜索，当有对象不在搜索的路径上的时候，也就是不可达的时候，则说明它该被回收了。

比如下图的Object2,3,4因为在搜索路径上，是可达的，所以不会被GC回收。  
而Object5,6,7虽然有互相引用，但是不在根搜索的路径上，是不可达的，所以会被GC视为可回收对象。

![image](http://p1.bpimg.com/567571/1a6d6da2ca67ee60.png)

### GC Roots
那么哪些对象是GC Roots对象呢？
1. 虚拟机栈（栈帧中的本地变量表）中的引用的对象。
2. 方法区的类静态属性引用的对象。
3. 方法区的常量引用的对象。
4. 本地方法栈中JNI（即Native方法）的引用的对象。